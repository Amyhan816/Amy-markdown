## 3.7 不同对象间实现数据共享

//如果想在同类的多个对象之间实现数据共享，同时避免使用安全性低的全局变量，可以用<u>静态的数据成员</u>

### 3.7.1 把数据成员定义为静态

*静态数据成员是一种特殊的数据成员，它以关键词static开头*

```cpp
class Box
{
    public:
    int volume();
    private:
    static int height;//把height定义为静态的数据成员
    int width;
    int length;
}
```

**1、静态数据成员的值对所有对象都是一样的，如果改变它的值，则在各对象中这个数据成员的值都同时改变了。

**2、类的一般数据成员是不占内存空间的，只有在定义对象时，才为对象的数据成员分配空间。 但是，静态数据成员不属于某一个对象，它是在所有对象之外单独开辟空间。**只要类中指定了静态数据成员，即使没有定义对象，也为静态数据成员分配空间**，它可以被引用。

**3、静态数据成员不随对象的撤销而释放，它在开始运行程序时就占用分配的内存，到程序结束时才释放空间。

**4、公用的静态数据成员可以初始化，但只能在类体外初始化

其一般形式为：数据类型 类名：：静态数据成员名=初值；

```cpp
int Box::height=10;
```

//不能在构造函数的参数初始化表对静态数据成员初始化

```cpp
Box(int h,int w,int len):height(h){}//错误
```

**5、静态数据成员既可通过对象名引用，也可以通过类名引用

#### 输入立方体的体积，使用静态数据成员

```cpp
#include<iostream>
using namespace std;
class Box
{
public:
    Box(int,int);
    int volume();
    static int height;//把height定义为公用的静态数据
    int width;
    int length;
};
Box::Box(int w,int len)//通过构造函数对width、length赋值
{
    width=w;
    length=len;
}
int Box::volume()//定义成员函数volume
{
    return(height*width*length);
}
int Box::height=10;//对公用静态数据成员height初始化

int main()
{
    Box a(15,20),b(20,30);//建立两个对象
    cout<<a.height<<endl;//通过变量名a引用静态数据成员
    cout<<b.height<<endl;//通过变量名b引用静态数据成员
    cout<<Box::height<<endl;//通过类名引用静态数据成员
    cout<<a.volume()<<endl;
    return 0;
}


```

*由于height为公用静态数据成员，故可以在类外直接引用*

**如果静态数据成员被定义为私有的，则需要调用公用成员函数引用



### 3.7.2 用静态成员函数访问静态数据成员

*成员函数也可定义为静态的*

```cpp
static int volume();
```

*静态成员函数是类的一部分，可以通过类名：：调用*

```cpp
Box::volume();
```

*也允许通过对象名进行调用*

```cpp
a.volume();//可以调用，但不意味着该函数属于对象a
```

**静态成员函数与非静态函数根本区别：**

由于静态成员函数不属于某一对象，它与任何对象都无关。印次静态成员函数**没有this指针**，它不能访问本类中的非静态成员。

**静态成员函数可以直接引用本类的静态成员（同属于类）

**在c++中，静态成员函数主要用来访问静态数据成员，而不访问非静态数据成员。

```cpp
...
static int height;
int width;
...
cout<<height<<endl;//引用本类中的静态成员，合法
cout<<width<<endl;//width为非静态成员，非法
```

**静态成员函数并不是绝对不能引用本类非静态成员，只是不能进行默认访问（无法知道该去找哪个对象）

```cpp
Box a(12,23,34);
cout<<a.width<<endl;//加上对象名和成员运算符即可引用本类非静态成员
```

#### 引用非静态成员具体方法：

```cpp
#include<iostream>
using namespace std;
class Student//定义Students类
{
public:
    Student(int n,int a,float s):num(n),age(a),score(s){}//定义构造函数
    void total();//声明成员函数
    static float average();//声明静态成员函数（可以直接引用私有静态数据成员）
private:
    int num;
    int age;
    float score;
//由于sum和count是属于类的而不是属于某一对象的，把它们定义为静态数据成员
    static float sum;//静态数据成员sum
    static int count;//静态数据成员count（计数）
};

void Student::total()//定义非静态成员函数
{
    sum+=score;//累加总分
    count++;//累计已统计的人数
}

float Student::average()//定义静态成员函数
{
    return(sum/count);
}

float Student::sum=0;//对静态数据成员初始化
int Student::count=0;//对静态数据成员初始化

int main()
{
    Student stud[3]={ //定义对象数组并初始化
        Student(1001,18,70),
        Student(1002,19,78),
        Student(1003,20,98)
    };
    int n;
    cout<<"please input the number of students: ";
    cin>>n;//输入需要求多少学生的平均成绩
    for(int i=0;i<n;i++)//调用三次total函数
        stud[i].total();
    cout<<"the average score of "<<n<<"students is "<<Student::average()<<endl;//调用静态成员函数
    return 0;


}


```

*编写c++程序时，应养成习惯：只用静态成员函数引用静态数据成员，而不引用非静态数据成员*
